
        <!DOCTYPE html>
        <html lang="ru">
        <head>
            <meta charset="UTF-8">
            <title>Аналитический отчет за 2025 год</title>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
            <style>
                body {
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                    margin: 0; padding: 20px; background-color: #f8f9fa; color: #212529;
                }
                .main-container { max-width: 1140px; margin: auto; display: flex; flex-direction: column; gap: 20px; }
                h1 { text-align: center; color: #343a40; margin-bottom: 20px; font-size: 1.8em; font-weight: 600;}
                h2 {
                    font-size: 1.2em; color: #212529; font-weight: 600; margin-top: 0; margin-bottom: 15px;
                    padding-bottom: 10px; border-bottom: 1px solid #dee2e6;
                }
                .card {
                    background: #ffffff; border: 1px solid #e9ecef; border-radius: 0.5rem;
                    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); padding: 1.5rem;

                    /* ИЗМЕНЕНИЯ ДЛЯ ВЫРАВНИВАНИЯ КАРТОЧЕК */
                    flex: 1; 
                    display: flex;
                    flex-direction: column;
                }
                /* ИЗМЕНЕНИЯ ДЛЯ ВЫРАВНИВАНИЯ КАРТОЧЕК */
                .partners-container { 
                    display: flex; 
                    gap: 20px; 
                }
                .chart-container { position: relative; height: 280px; max-width: 280px; margin: 10px auto; }
                #chart-center-text {
                    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    text-align: center; font-size: 2.5em; font-weight: 600; color: #198754;
                }
                .styled-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
                .styled-table th {
                    text-align: left; padding: 0.75rem 0.5rem; border-bottom: 2px solid #6c757d;
                    font-weight: 600; color: #495057;
                }
                .styled-table td { padding: 0.75rem 0.5rem; text-align: left; border-bottom: 1px solid #e9ecef; }
                .styled-table tr:last-child td { border-bottom: none; }
                .styled-table th:nth-child(2), .styled-table td:nth-child(2),
                .styled-table th:nth-child(3), .styled-table td:nth-child(3) { 
                    text-align: right; 
                }

                /* ИСПРАВЛЕНИЕ: Запрещаем перенос заголовков "Оценка" и "Кол-во оценок" */
                .styled-table th:nth-child(2),
                .styled-table th:nth-child(3) {
                    white-space: nowrap;
                }

                /* ИЗМЕНЕНИЯ ДЛЯ ВЫРАВНИВАНИЯ КАРТОЧЕК (МОБ. ВЕРСИЯ) */
                @media (max-width: 768px) { 
                    .partners-container { 
                        flex-direction: column; 
                    } 
                }
            </style>
        </head>
        <body>
            <div class="main-container">
                <div class="card">
                    <h2 style="text-align: center;">Доля открытий с критичными замечаниями</h2>
                    <div class="chart-container">
                        <canvas id="criticalChart"></canvas>
                        <div id="chart-center-text"></div>
                    </div>
                </div>
                <div class="partners-container">
                    <div class="card"> <h2>ТОП-5 партнеров</h2> <table class="dataframe styled-table">
  <thead>
    <tr style="text-align: right;">
      <th>Партнер</th>
      <th>Оценка</th>
      <th>Кол-во оценок</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Мариненко Константин</td>
      <td>99.85</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Жестовский Андрей</td>
      <td>98.66</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Яковлев Вячеслав</td>
      <td>98.63</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Богданов Евгений</td>
      <td>97.97</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Цуканов Виктор, Цуканова Екатерина</td>
      <td>97.50</td>
      <td>1</td>
    </tr>
  </tbody>
</table> </div>
                    <div class="card"> <h2>АнтиТОП-5 партнеров</h2> <table class="dataframe styled-table">
  <thead>
    <tr style="text-align: right;">
      <th>Партнер</th>
      <th>Оценка</th>
      <th>Кол-во оценок</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Гришкян Грант</td>
      <td>68.93</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Соколов Павел</td>
      <td>72.13</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Качин Михаил</td>
      <td>79.40</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Руцкий Антон, Руцкий Константин</td>
      <td>80.64</td>
      <td>1</td>
    </tr>
    <tr>
      <td>Костин Юрий</td>
      <td>80.99</td>
      <td>1</td>
    </tr>
  </tbody>
</table> </div>
                </div>
                <div class="card"> <h2>Качество по федеральным округам</h2> <table class="dataframe styled-table">
  <thead>
    <tr style="text-align: right;">
      <th>Наименование округа</th>
      <th>Кол-во оценок</th>
      <th>Ср. оценка</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Сибирский ФО</td>
      <td>4</td>
      <td>94.24</td>
    </tr>
    <tr>
      <td>Дальневосточный ФО</td>
      <td>1</td>
      <td>93.99</td>
    </tr>
    <tr>
      <td>Северо-Западный ФО</td>
      <td>6</td>
      <td>92.50</td>
    </tr>
    <tr>
      <td>Ленинградский регион</td>
      <td>3</td>
      <td>91.84</td>
    </tr>
    <tr>
      <td>Южный ФО</td>
      <td>8</td>
      <td>91.33</td>
    </tr>
    <tr>
      <td>Московский регион</td>
      <td>6</td>
      <td>90.06</td>
    </tr>
    <tr>
      <td>Казахстан</td>
      <td>3</td>
      <td>89.09</td>
    </tr>
    <tr>
      <td>Центральный ФО</td>
      <td>6</td>
      <td>88.56</td>
    </tr>
    <tr>
      <td>Приволжский ФО</td>
      <td>10</td>
      <td>86.02</td>
    </tr>
    <tr>
      <td>Северо-Кавказский ФО</td>
      <td>3</td>
      <td>84.62</td>
    </tr>
  </tbody>
</table> </div>
            </div>
            <script>
                Chart.register(ChartDataLabels);
                // Добавлена защита .get()
                const chartData = [127, 13];
                const ctx = document.getElementById('criticalChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['С критичными замечаниями', 'Без критичных замечаний'],
                        datasets: [{
                            label: 'Количество объектов', data: chartData,
                            backgroundColor: ['#F37A7A', '#97E1B0'], borderColor: '#ffffff', borderWidth: 4,
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false, cutout: '70%',
                        plugins: {
                            legend: { position: 'top' },
                            datalabels: {
                                formatter: (value, ctx) => {
                                    let sum = ctx.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    if (sum === 0) return '0%';
                                    // Добавлена защита от NaN и скрытие <1%
                                    let percentage = (value * 100 / sum);
                                    if (isNaN(percentage)) return '0%';
                                    return percentage < 1 ? '' : percentage.toFixed(1) + '%';
                                },
                                color: (context) => {
                                    const value = context.dataset.data[context.dataIndex];
                                    const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    const percentage = total > 0 ? (value / total) * 100 : 0;
                                    // Цвет #333 для маленьких сегментов, чтобы было видно
                                    return percentage < 15 ? '#333333' : '#ffffff';
                                },
                                font: { weight: 'bold', size: 12 }
                            }
                        }
                    }
                });
                const sum = chartData.reduce((a, b) => a + b, 0);
                const withoutCriticalValue = chartData[1];
                let percentage = 0;
                if (sum > 0) { percentage = (withoutCriticalValue * 100 / sum).toFixed(1); }
                document.getElementById('chart-center-text').innerHTML = percentage + '%';
            </script>
        </body>
        </html>
        